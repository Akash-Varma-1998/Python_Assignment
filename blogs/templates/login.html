{% extends 'index.html' %} {% block content %}
<section class="wrapper">
  <div class="form signup">
    <header>Signup</header>
        <!-- Display messages -->
        {% if messages %}
        <div class="messages">
          {% for message in messages %}
          <div class="alert alert-{{ message.tags }}" style="color: yellow;">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}
    <form id="signupForm" action="{% url 'register' %}" method="post">
      {% csrf_token %}
      <input
        type="text"
        id="fullname"
        placeholder="Full name"
        name="fullname"
        value="{{ form.fullname.value }}"
      />
      <span id="fullNameError" class="error-message"></span>
      <input
        type="text"
        id="email"
        placeholder="Email address"
        name="email"
        value="{{ form.email.value }}"
      />
      <span id="emailError" class="error-message"></span>
      <input
        type="password"
        id="password"
        placeholder="Password"
        name="password1"
        value="{{ form.password1.value }}"
      />
      <span id="passwordError" class="error-message"></span>
      <input
        type="password"
        id="confirmPassword"
        placeholder="Confirm Password"
        name="password2"
        value="{{ form.password2.value }}"
      />
      <span id="confirmPasswordError" class="error-message"></span>
      <!-- <div class="checkbox">
        <input type="checkbox" id="signupCheck" />
        <label for="signupCheck">I accept all terms & conditions</label>
      </div> -->
      <input type="submit" value="Signup" />
    </form>
  </div>

  <div class="form login">
    <header>Login</header>
    <form action="{% url 'login' %}" method="post">
      {% csrf_token %}
      <input
        type="text"
        id="email"
        placeholder="Email address"
        name="email"
        value="{{ form.email.value }}"
      />
      <span id="emailError" class="error-message"></span>
      <input
        type="password"
        id="password"
        placeholder="Password"
        name="password"
        value="{{ form.password.value }}"
      />
      <span id="passwordError" class="error-message"></span>
      <a href="#">Forgot password?</a>
      <input type="submit" value="Login" />
    </form>
  </div>



  <script>
    document
      .getElementById("signupForm")
      .addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission for now
        validateForm();
      });

    function validateForm() {
      var fullName = document.getElementById("fullname").value;
      var email = document.getElementById("email").value;
      var password = document.getElementById("password").value;
      var confirmPassword = document.getElementById("confirmPassword").value;

      document.getElementById("fullNameError").textContent = "";
      document.getElementById("emailError").textContent = "";
      document.getElementById("passwordError").textContent = "";
      document.getElementById("confirmPasswordError").textContent = "";

      var hasError = false;
      var specialChars = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;
      if (fullName.trim() === "") {
        document.getElementById("fullNameError").textContent =
          "Please enter your full name.";
        hasError = true;
      }
      if (specialChars.test(fullName)) {
        document.getElementById("fullNameError").textContent =
          "Name cannot contain special characters.";
        hasError = true;
      }
      if (email.trim() === "") {
        document.getElementById("emailError").textContent =
          "Please enter your email address.";
        hasError = true;
      }
      if (email.toUpperCase() === email) {
        document.getElementById("emailError").textContent =
          "Email cannot be all uppercase.";
        hasError = true;
      }
      if (email.length <= 15) {
        document.getElementById("emailError").textContent =
          "Email should be more than 15 characters.";
        hasError = true;
      }
      if (password.length < 8 || password.length > 30) {
        document.getElementById("passwordError").textContent =
          "Password should be between 8 and 30 characters.";
        hasError = true;
      }
      if (password !== confirmPassword) {
        document.getElementById("confirmPasswordError").textContent =
          "Passwords do not match.";
        hasError = true;
      }

      if (!hasError) {
        document.getElementById("signupForm").submit();
      }
    }
    document
      .getElementById("loginForm")
      .addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission for now
        validateLoginForm();
      });

    function validateLoginForm() {
      var email = document.getElementById("email").value;
    var password = document.getElementById("password").value;

    // Reset error messages
    document.getElementById("emailError").textContent = "";
    document.getElementById("passwordError").textContent = "";

    // Get CSRF token
    var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;

    // Validation logic
    var hasError = false;
    var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        document.getElementById("emailError").textContent =
            "Please enter a valid email address.";
        hasError = true;
    }
    if (password.length < 8) {
        document.getElementById("passwordError").textContent =
            "Password should be at least 8 characters.";
        hasError = true;
    }

    // If no errors, proceed with login
    if (!hasError) {
        // Include CSRF token in the form data
        var formData = new FormData();
        formData.append('csrfmiddlewaretoken', csrfToken);
        formData.append('email', email);
        formData.append('password', password);

        // Your AJAX code here to submit the form data or directly submit the form
        // Example using fetch API:
        fetch("{% url 'login' %}", {
            method: "POST",
            body: formData
        })
        .then(response => {
            if (response.ok) {
                alert("Login successful!");
            } else {
                alert("Login failed. Please check your credentials.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred during login.");
        });
    }
    }
  </script>
</section>
{% endblock %}
