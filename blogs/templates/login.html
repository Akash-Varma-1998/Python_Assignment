{% extends 'index.html' %} {% block content %}
<section class="wrapper login-wrapper">
  <div class="form-block">
    <div class="form signup">
      <div class="form-title mb-3">Login</div>
          <!-- Display messages -->
          {% if messages %}
          <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="color: yellow;">
              {{ message }}
            </div>
            {% endfor %}
          </div>
          {% endif %}
      <form action="{% url 'login' %}" method="post">
        {% csrf_token %}
        <div class="row">
          <div class="col-lg-6 mb-3">
            <div class="form-field">
              <input
          type="text"
          id="email"
          placeholder="Email address"
          name="email"
          value="{{ form.email.value }}"
        />
        <span id="emailError" class="error-message"></span>
            </div>
          </div>
          <div class="col-lg-6 mb-3">
            <div class="form-field">
              <input
              type="password"
              id="password"
              placeholder="Password"
              name="password"
              value="{{ form.password.value }}"
            />
            <span id="passwordError" class="error-message"></span>
            </div>
          </div>
        </div>
         
        <button type="submit" value="Login">Submit</button>
        <a class="signup-txt" type="submit" value="Signup" href="{% url 'signup' %}">Signup</a>
      </form>
    </div>
    <!-- <div class="form login">
      <div class="form-title mb-3">Login</div>
      <form action="{% url 'login' %}" method="post">
        {% csrf_token %}
        <input
          type="text"
          id="email"
          placeholder="Email address"
          name="email"
          value="{{ form.email.value }}"
        />
        <span id="emailError" class="error-message"></span>
        <input
          type="password"
          id="password"
          placeholder="Password"
          name="password"
          value="{{ form.password.value }}"
        />
        <span id="passwordError" class="error-message"></span>
        <a href="#">Forgot password?</a>
        <input type="submit" value="Login" />
      </form>
    </div> -->
  </div>

  <script>
    document
      .getElementById("signupForm")
      .addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission for now
        validateForm();
      });

    function validateForm() {
      var fullName = document.getElementById("fullname").value;
      var email = document.getElementById("email").value;
      var password = document.getElementById("password").value;
      var confirmPassword = document.getElementById("confirmPassword").value;

      document.getElementById("fullNameError").textContent = "";
      document.getElementById("emailError").textContent = "";
      document.getElementById("passwordError").textContent = "";
      document.getElementById("confirmPasswordError").textContent = "";

      var hasError = false;
      var specialChars = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;
      if (fullName.trim() === "") {
        document.getElementById("fullNameError").textContent =
          "Please enter your full name.";
        hasError = true;
      }
      if (specialChars.test(fullName)) {
        document.getElementById("fullNameError").textContent =
          "Name cannot contain special characters.";
        hasError = true;
      }
      if (email.trim() === "") {
        document.getElementById("emailError").textContent =
          "Please enter your email address.";
        hasError = true;
      }
      if (email.toUpperCase() === email) {
        document.getElementById("emailError").textContent =
          "Email cannot be all uppercase.";
        hasError = true;
      }
      if (email.length <= 15) {
        document.getElementById("emailError").textContent =
          "Email should be more than 15 characters.";
        hasError = true;
      }
      if (password.length < 8 || password.length > 30) {
        document.getElementById("passwordError").textContent =
          "Password should be between 8 and 30 characters.";
        hasError = true;
      }
      if (password !== confirmPassword) {
        document.getElementById("confirmPasswordError").textContent =
          "Passwords do not match.";
        hasError = true;
      }

      if (!hasError) {
        document.getElementById("signupForm").submit();
      }
    }
    document
      .getElementById("loginForm")
      .addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission for now
        validateLoginForm();
      });

    function validateLoginForm() {
      var email = document.getElementById("email").value;
    var password = document.getElementById("password").value;

    // Reset error messages
    document.getElementById("emailError").textContent = "";
    document.getElementById("passwordError").textContent = "";

    // Get CSRF token
    var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;

    // Validation logic
    var hasError = false;
    var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        document.getElementById("emailError").textContent =
            "Please enter a valid email address.";
        hasError = true;
    }
    if (password.length < 8) {
        document.getElementById("passwordError").textContent =
            "Password should be at least 8 characters.";
        hasError = true;
    }

    // If no errors, proceed with login
    if (!hasError) {
        // Include CSRF token in the form data
        var formData = new FormData();
        formData.append('csrfmiddlewaretoken', csrfToken);
        formData.append('email', email);
        formData.append('password', password);

        // Your AJAX code here to submit the form data or directly submit the form
        // Example using fetch API:
        fetch("{% url 'login' %}", {
            method: "POST",
            body: formData
        })
        .then(response => {
            if (response.ok) {
                alert("Login successful!");
            } else {
                alert("Login failed. Please check your credentials.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred during login.");
        });
    }
    }
  </script>
</section>
{% endblock %}
